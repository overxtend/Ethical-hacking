# WebDAV Misconfiguration Lab: `PUT` Enabled Under `/dav/` (Metasploitable)

> **Purpose (Authorized Training Lab Only)**  
> This write-up is designed for an ethical hacking / CEH-style classroom lab using **Kali Linux** against **Metasploitable** in a controlled environment.  
> The goal is to teach **detection, validation, and professional reporting** of an unsafe HTTP/WebDAV configuration (exposed `PUT`).  
>
> ✅ This lab focuses on **method discovery + evidence collection + risk analysis + remediation**.  
> ❌ This write-up **does not** include web shells, command execution payloads, or reverse shells.

---

## Table of Contents

- [Learning Outcomes](#learning-outcomes)
- [Scope & Rules of Engagement](#scope--rules-of-engagement)
- [Background: Why `PUT` Matters](#background-why-put-matters)
- [Step 1 — Banner Grabbing on Port 80](#step-1--banner-grabbing-on-port-80)
- [Step 2 — Enumerate HTTP Methods with Nmap](#step-2--enumerate-http-methods-with-nmap)
- [Step 3 — Why `OPTIONS /dav/` May Not Show `PUT`](#step-3--why-options-dav-may-not-show-put)
- [Step 4 — Correct Validation: Test a File Path](#step-4--correct-validation-test-a-file-path)
- [Step 5 — Evidence Collection Checklist](#step-5--evidence-collection-checklist)
- [Professional Finding Template (Report-Ready)](#professional-finding-template-report-ready)
- [Instructor Prompts (With Answers)](#instructor-prompts-with-answers)
- [Defensive Hardening Notes (Apache/WebDAV)](#defensive-hardening-notes-apachewebdav)
- [Appendix — Commands Used (Discovery Only)](#appendix--commands-used-discovery-only)

---

## Learning Outcomes

By the end of this lab, students will be able to:

- Perform HTTP banner grabbing on port **80/tcp**.
- Enumerate HTTP and WebDAV methods with **Nmap**, **curl**, and **manual netcat**.
- Explain why `PUT` might appear on a **file resource** but not on a **collection** (`/dav/`).
- Produce a report-quality security finding: **evidence → impact → likelihood → remediation**.
- Recommend hardening steps to reduce exposure from unsafe HTTP/WebDAV methods.

---

## Scope & Rules of Engagement

**Attacker (Student):** Kali Linux  
**Target:** Metasploitable  
**Target IP:** `192.168.56.103`  
**Service:** HTTP on `80/tcp`  
**In-scope path:** `/dav/`

**Boundaries:**
- This lab is limited to **method discovery** and **documentation**.
- Do not upload malicious content or execute commands on the target in this exercise.
- If your organization uses formal ROE, include them here (time window, logging, approval ticket, etc.).

---

## Background: Why `PUT` Matters

The **HTTP `PUT`** method is typically used to upload or replace data at a user-supplied URL (e.g., `PUT /dav/file.txt`).  
If a server is misconfigured and allows unauthorized `PUT`, an attacker may be able to:

- Place arbitrary content on the server (defacement / content hosting)
- Host phishing pages or malicious client-side scripts (served to other users)
- Establish persistence by leaving attacker content accessible
- Escalate further depending on server execution rules and access controls

> **Key note:** The `Allow:` header is **informational**. Real enforcement is done via authentication/authorization, filesystem permissions, and server configuration.  
> Still, `Allow: PUT` on a WebDAV path is strong evidence of *attack surface* and must be documented.

---

## Step 1 — Banner Grabbing on Port 80

### Option A: Netcat (raw HTTP)

Connect:

```bash
nc -vvvv 192.168.56.103 80
```

Then type the following request and press **Enter twice**:

```http
OPTIONS /dav/ HTTP/1.0

```

**What to capture as evidence:**
- `Server:` header (web server + version)
- `DAV:` headers (indicates WebDAV support)
- `MS-Author-Via:` (common with DAV)
- `Allow:` header contents

### Option B: curl (clean headers)

```bash
curl -i -X OPTIONS http://192.168.56.103/dav/
```

---

## Step 2 — Enumerate HTTP Methods with Nmap

Run the `http-methods` script against the `/dav/` path:

```bash
nmap -p80 --script http-methods --script-args http-methods.url-path='/dav/' 192.168.56.103
```

**Expected outcome:** You will often see DAV verbs like `PROPFIND`, `COPY`, `MOVE`, `LOCK`, `UNLOCK` and possibly `DELETE` / `TRACE`.

> **Important:** You may **not** see `PUT` here. That does not automatically mean `PUT` is unavailable.

---

## Step 3 — Why `OPTIONS /dav/` May Not Show `PUT`

This is a common point of confusion. Here’s the correct mental model:

### 1) `/dav/` is a **collection** (directory)
Many servers treat `/dav/` as a **collection resource**.  
Apache may even indicate this with a directory-like content type (commonly `httpd/unix-directory`).

### 2) `PUT` is primarily a **file resource** method
`PUT` is meant to create or replace a **file** resource, such as:

- `/dav/test.txt`
- `/dav/notes.html`

So a server may advertise different methods for:
- a collection: `/dav/`
- a (potential) file: `/dav/random.txt`

### 3) Authentication can change what’s advertised
Some setups only allow `PUT` after authentication/authorization, so unauthenticated enumeration may omit it.

### 4) `Allow:` is a hint (not a guarantee)
Even if `Allow` lists a method, the server may still block it at execution time via permissions or policy.  
**Validation** requires testing behavior in a safe manner.

---

## Step 4 — Correct Validation: Test a File Path

### 4.1 Check `OPTIONS` on a file under `/dav/` (no file creation needed)

```bash
curl -i -X OPTIONS http://192.168.56.103/dav/put-check.txt
```

It’s common to see an `Allow:` header like:

```http
Allow: OPTIONS,MKCOL,PUT,LOCK
```

This indicates WebDAV creation/locking methods are supported for **file-like resources** under `/dav/`.

### 4.2 Confirm with Nmap against the file path

```bash
nmap -p80 --script http-methods --script-args http-methods.url-path='/dav/put-check.txt' 192.168.56.103
```

> If `PUT` shows up here but not on `/dav/`, that is expected behavior and is worth explaining in your report.

---

## Step 5 — Evidence Collection Checklist

Include the following in your lab submission or professional report:

- Output of:
  - `curl -i -X OPTIONS http://<target>/dav/`
  - `curl -i -X OPTIONS http://<target>/dav/<file>.txt`
  - Nmap `http-methods` output for both paths
- Headers proving WebDAV:
  - `Server: ... DAV/2`
  - `DAV: 1,2` (or similar)
  - `MS-Author-Via: DAV` (if present)
- `Allow:` header showing `PUT` on a file path

---

## Professional Finding Template (Report-Ready)

### Title
**WebDAV Misconfiguration: HTTP `PUT` Enabled Under `/dav/`**

### Severity (Suggested)
- **High**: if unauthenticated write is possible and the service is reachable by untrusted users
- **Medium**: if authentication is required or exposure is restricted to a trusted internal segment
- **Context-dependent**: if writing is possible but content is not executable and is strongly constrained

### Description
The target web server exposes WebDAV functionality under `/dav/`. `OPTIONS` requests to file paths under `/dav/` advertise `PUT`, indicating the server supports file upload/replace operations via WebDAV. If improperly restricted, this could allow attackers to place arbitrary content on the server.

### Evidence (Example)
- `OPTIONS /dav/put-check.txt` returns `Allow: ... PUT ...`
- WebDAV headers present: `DAV: 1,2`, `MS-Author-Via: DAV`

### Impact
If unauthorized writes are possible, an attacker could:
- Place arbitrary content on the server (defacement, content hosting)
- Host malicious client-side content that impacts other users
- Establish persistence via stored attacker content
- Potentially escalate further depending on server execution rules and configuration

### Recommendation
- Disable WebDAV if not required.
- If WebDAV is required:
  - Require strong authentication and least-privilege authorization.
  - Restrict allowed HTTP methods to business need.
  - Store uploads outside executable web roots; disable script execution in upload locations.
  - Apply strict filesystem permissions; ensure the web server account cannot write broadly.
  - Monitor and alert on WebDAV verbs (`PUT`, `MKCOL`, `PROPFIND`, `MOVE`, `COPY`, `LOCK`).

---

## Instructor Prompts (With Answers)

**Q1: Why can `OPTIONS /dav/` omit `PUT`, but `OPTIONS /dav/file.txt` includes it?**  
**A:** `/dav/` is a collection (directory). `PUT` is primarily used on file resources. Servers often advertise different methods for collections vs file endpoints.

**Q2: Is `Allow: PUT` proof that upload succeeds?**  
**A:** It’s strong evidence of *supported capability*, but actual success depends on permissions, auth, and filesystem configuration.

**Q3: Why is WebDAV risky compared to plain HTTP?**  
**A:** WebDAV adds file-management verbs that expand the attack surface. Misconfigurations can enable content placement and persistence.

**Q4: What determines High vs Medium severity?**  
**A:** Exposure (internet vs internal), whether auth is required, whether writes are permitted, and whether uploaded content can impact users or be executed.

---

## Defensive Hardening Notes (Apache/WebDAV)

Discuss these controls in class:

- Disable DAV modules if not needed.
- Protect DAV paths with strong authentication and authorization.
- Restrict methods to minimum required.
- Ensure upload locations are non-executable (no PHP/CGI execution).
- Apply strict filesystem permissions.
- Add logging and alerting for DAV verbs in access logs.

---

## Appendix — Commands Used (Discovery Only)

```bash
# Nmap method enumeration (directory)
nmap -p80 --script http-methods --script-args http-methods.url-path='/dav/' 192.168.56.103

# Nmap method enumeration (file path)
nmap -p80 --script http-methods --script-args http-methods.url-path='/dav/put-check.txt' 192.168.56.103

# curl OPTIONS (directory)
curl -i -X OPTIONS http://192.168.56.103/dav/

# curl OPTIONS (file path)
curl -i -X OPTIONS http://192.168.56.103/dav/put-check.txt

# netcat manual OPTIONS (directory)
nc -vvvv 192.168.56.103 80
# then type:
# OPTIONS /dav/ HTTP/1.0
# [enter]
# [enter]

# netcat manual OPTIONS (file path)
nc -vvvv 192.168.56.103 80
# then type:
# OPTIONS /dav/put-check.txt HTTP/1.0
# [enter]
# [enter]
```

---

### License / Attribution (Optional)
You can add a license note here (e.g., MIT) and your course attribution.
